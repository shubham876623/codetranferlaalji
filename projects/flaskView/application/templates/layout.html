<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title >Cases Logging View</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="keywords">
  <meta content="" name="description">
  <!-- Favicons -->
  <link href="img/favicon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Bootstrap CSS File -->
  <link href="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}" rel="stylesheet">

<!--    jquery-->
    <script src="{{ url_for('static',filename='lib/jquery/jquery.min.js') }}"></script>
     <script src="{{ url_for('static',filename='lib/jquery/jquery.cookie.min.js') }}"></script>

    <link href="{{ url_for('static',filename='lib/airDatePicker/datepicker.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static',filename='lib/airDatePicker/datepicker.js') }}"></script>
    <script src="{{ url_for('static',filename='lib/airDatePicker/datepicker.en.js') }}"></script>
  <!-- Libraries CSS Files -->
    <link href="{{ url_for('static',filename='lib/animate/animate.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='lib/ionicons/css/ionicons.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='lib/owlcarousel/assets/owl.carousel.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static',filename='lib/Chartjs/Chart.js') }}"></script>
  <!-- Main Stylesheet File -->
  <link href="{{ url_for('static',filename='css/style.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='lib/clockPicker/clockpicker.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='lib/clockPicker/standalone.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='lib/fontawesome/css/all.css') }}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <!--/ Nav Star /-->
  <nav class="navbar navbar-default navbar-trans navbar-expand-lg fixed-top">
    <div class="container">
      <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarDefault"
        aria-controls="navbarDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a class="navbar-brand text-brand" id="logo" href="{{ url_for('home')}}">
          Case Logging View
      </a>
      <button type="button" class="btn btn-link nav-search navbar-toggle-box-collapse d-md-none" data-toggle="collapse"
        data-target="#navbarTogglerDemo01" aria-expanded="false">
        <span class="fa fa-search" aria-hidden="true"></span>
      </button>
      {% block nav %}{% endblock %}
    </div>
  </nav>
  <!--/ Nav End /-->
  <!--/ Intro Single star /-->
  {% block status %}
  {% endblock %}
  <!--/ Intro Single End /-->
<!--container-->
<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
            {% for category,message in messages %}
{#            <div class="alert alert-{{ category }} col-lg-6">{{message}}</div>#}
                <script>

                    Swal.fire({

                        title:"{{ category.title() }}!",
                        // success , error , warning ,info

                        text: "{{ message }}",
                        // Custom message flashed from your flask routes

                        icon: "{{ category }}" === "danger" ? "error" : "{{ category }}"
                        // success , error , warning ,info

                    })

                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}
<script type="text/javascript">
    var currentPage = window.location.pathname;
    $('div ul li a').each(function(){
        if($(this).attr('href') == currentPage){
            $(this).addClass('active');
        }
    });
</script>
    <script>
        const getData = (url,method,data,handleData) => {
            $.ajax({
                url: url,
                method: method,
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(data),
                success: function (result) {
                    handleData(result);
                }
            });
      }
    </script>

  {% block content %}{% endblock %}

 <style>
    .slot_sep{
        border-left: 3px solid lightgrey;
        padding-left: 5px;
    }
    .sub_button{
        border:2px solid lightgrey;
        padding: 2px 8px;
        border-radius:4px;
        font-weight: 800;
        color:#ababab;
    }
    .sub_button_danger{
        border:2px solid lightcoral;
        padding: 2px 8px;
        border-radius:4px;
        font-weight: 800;
        color:lightcoral;
    }

    .sub_button_primary{
        border:2px solid dodgerblue;
        padding: 2px 8px;
        border-radius:4px;
        font-weight: 800;
        color:dodgerblue;
    }

    .sub_button:hover{
        border:2px solid #121212;
        padding: 2px 8px;
        border-radius:4px;
        font-weight: 800;
        color:#121212;
    }
    .sub_button_danger:hover{
        border:2px solid darkred;
        padding: 2px 8px;
        border-radius:4px;
        font-weight: 800;
        color:darkred;
    }
    .smalled{
        font-size: 10px;
        display: block;
        color: lightgrey;
        padding-top:5px;
    }
    .lightgreyish{
        color:#cecece;
    }
    .limit{
        margin-top:-3px;
        margin-bottom:2px;
        font-size:14px;
    }

    </style>

</div>
<!--  end container-->
    <div id="preloader"></div>
          <!-- JavaScript Libraries -->
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
          <script src="{{ url_for('static',filename='lib/popper/popper.min.js') }}"></script>
          <script src="{{ url_for('static',filename='/bootstrap/js/bootstrap.js') }}"></script>
          <script src="{{ url_for('static',filename='lib/easing/easing.min.js') }}"></script>
          <script src="{{ url_for('static',filename='lib/owlcarousel/owl.carousel.min.js') }}"></script>
          <script src="{{ url_for('static',filename='lib/scrollreveal/scrollreveal.min.js') }}"></script>
          <script src="{{ url_for('static',filename='lib/clockPicker/clockpicker.js') }}"></script>

          <!-- Contact Form JavaScript File -->
          <script src="{{ url_for('static',filename='contactform/contactform.js') }}"></script>

          <!-- Template Main Javascript File -->
          <script src="{{ url_for('static',filename='js/main.js') }}"></script>
          <script src="{{ url_for('static',filename='js/utility.js') }}"></script>
  <script>

       let link_ = window.location.origin

        $(function () {
          $('[data-toggle="tooltip"]').tooltip()
        })
        let url = window.location.origin;

        $("#mpesa").on("click",()=>{
	        window.location = (`${url}/payments`)
        })
        $("#card").on("click",()=>{
            window.location = (`${url}/card`)
        })
        $("#reports").on("click",()=>{
            window.location = (`${url}/reports`)
        })

        const info =(me)=>{
            console.log(me.id)
            let current_location = window.location.href;
            sessionStorage.setItem("prev",current_location)
            let id = me.id;
            window.location = `${url}/info/${id}`
        };

        const prefillForm = (data, title = "") => {
            // get the table handle
            let handle = $("#report");
            if (title !== "") {
                handle.append(`<tr><td>${title}</td></tr>`)
            }
            // working with the report data
            // mappiong begins
            mapper =["Local","Online","Instant"]
            data.map((value, key) => {
                let id = value.id;
                let branch_id = value.branch_id;
                let active_ = value.active ? "Active" : "Serviced";
                let forwarded = value.forwarded ? "Fowarded": "Not Forwarded";
                let kind = mapper["kind"];
                let service_name = value.service_name;
                let serviced = value.serviced;
                let start = value.start;
                let teller = value.teller;
                let user = value.user;

                handle.append(
                    `<tr class="asset" onclick="" id="${id}">
                            <th data-id="${id}">${id}</th>
                            <td data-id="${id}">${branch_id}</td>
                            <td data-id="${id}">${active_}</td>
                            <td data-id="${id}">${forwarded}</td>
                            <td data-id="${id}">${kind}</td>
                            <td data-id="${id}">${service_name}</td>
                            <td data-id="${id}">${serviced}</td>
                            <td data-id="${id}">${start}</td>
                            <td data-id="${id}">${teller}</td>
                            <td data-id="${id}">${user}</td>
                        </tr>`)
            })
    }

      $('#back_payments').on("click",()=>{
        let location = sessionStorage.getItem("prev");
        window.location = location.length > 1 ? location : "http://localhost:3000/payments"
      });
      // genarate reports
      $("#generate_payments").on("click",()=>{

          getData(`http://${lnk}:3000/mpesa/reports`,"POST",{"kind":""},(data)=>{
              console.log(data)
              prefillForm(data,"Payment Reports")
          })
       });

      $("#report_main").on("click",()=>{
          console.log("single report")
      });
      $("#reverse_main").on("click",()=>{
          console.log("reserve transaction")
      })


  </script>
</body>
</html>